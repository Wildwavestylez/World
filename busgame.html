// Funkce pro vytvoření nové linky
function createRoute() {
    if (currentStops.length < 2) return alert("Musíte vybrat alespoň dvě zastávky!");

    // Kontrola, jestli máme dostatek peněz na vytvoření nové linky
    if (balance < costPerNewRoute) {
        return alert("Nemáte dostatek peněz na vytvoření nové linky!");
    }

    let start = currentStops[0];
    let end = currentStops[currentStops.length - 1];

    let line = {
        id: lineCounter,
        route: currentRoute,
        stops: [...currentStops],
        name: `Linka ${lineCounter}: ${start.getPopup().getContent()} → ${end.getPopup().getContent()}`,
        color: getRandomColor()
    };

    lines.push(line);
    lineCounter++;

    balance -= costPerNewRoute; // Odečteme cenu za vytvoření nové linky
    updateBalanceDisplay();

    updateLinesList();
    addBusToRoute(line); // Přidání autobusu na linku

    currentStops = [];
    currentRoute = null;
}

// Funkce pro přidání nové zastávky k existující lince
function extendRoute(lat, lon, marker) {
    let selectedLine = lines.find(line => line.id === expandingLine);
    if (!selectedLine) return;

    // Kontrola, jestli máme dostatek peněz na přidání nové zastávky
    if (balance < costPerNewStop) {
        return alert("Nemáte dostatek peněz na přidání nové zastávky!");
    }

    // Přidání nové zastávky
    selectedLine.stops.push(marker);

    // Aktualizace názvu linky podle poslední přidané zastávky
    selectedLine.name = `${selectedLine.name.split(" → ")[0]} → ${marker.getPopup().getContent()}`;

    balance -= costPerNewStop; // Odečteme cenu za přidání nové zastávky
    updateBalanceDisplay();

    // Aktualizace seznamu linek a vykreslení linky
    updateLinesList();
    redrawLine(selectedLine);

    // Po přidání jedné zastávky deaktivujeme režim rozšíření
    expandingLine = null;
    document.querySelectorAll('.line-item').forEach(i => i.classList.remove('selected'));
}
